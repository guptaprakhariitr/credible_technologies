<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redirecting… | Credible Technologies Apps</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>.redirect-page { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center; }</style>
</head>
<body>
  <div class="redirect-page">
    <h1>Redirecting…</h1>
    <p id="msg">
      Opening Geopolitics &amp; Conflict Monitor. If nothing happens,
      <a href="https://play.google.com/store/apps/details?id=com.prakshaappthree.appthree" id="storeLink">open it on Google Play</a>.
    </p>
  </div>
  <script>
    (function () {
      var msgEl = document.getElementById('msg');
      var storeLink = document.getElementById('storeLink');

      var path = window.location.pathname || '';
      var q = new URLSearchParams(window.location.search || '');
      var token = '';

      // 1) Prefer ?t=TOKEN if present
      if (q.has('t')) {
        token = q.get('t');
      } else {
        // 2) Support subdirectory paths like /credible_technologies/a/<token>
        var idx = path.indexOf('/a/');
        if (idx !== -1) {
          token = path.slice(idx + 3).split('/')[0].split('?')[0];
        }
      }

      var playStore = 'https://play.google.com/store/apps/details?id=com.prakshaappthree.appthree';
      var appStore = 'https://apps.apple.com/app/idXXXXXXXXX'; // TODO: replace with real iOS App Store URL if you add an iOS app

      if (!token) {
        msgEl.textContent = 'Invalid or missing link.';
        storeLink.href = playStore;
        return;
      }

      var scheme = 'worldconflicts://article/' + token;
      var ua = navigator.userAgent || '';
      var isAndroid = /Android/i.test(ua);
      var isIOS = /iPhone|iPad|iPod/i.test(ua);

      // Always set store link for manual tap
      storeLink.href = isIOS ? appStore : playStore;

      // Try to open app
      if (isAndroid) {
        window.location.href =
          'intent://article/' + token +
          '#Intent;scheme=worldconflicts;package=com.prakshaappthree.appthree;end';
      } else {
        window.location.href = scheme;
      }

      // Fallback to store after a short delay
      setTimeout(function () {
        msgEl.textContent = 'App not installed? Opening store…';
        window.location.href = isIOS ? appStore : playStore;
      }, 2500);
    })();
  </script>
</body>
</html>
